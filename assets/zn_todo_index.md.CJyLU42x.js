import{_ as t,c as h,j as i,a as n,t as k,aj as e,o as l}from"./chunks/framework.BjvEk-qr.js";const c=JSON.parse('{"title":"{{ $frontmatter.title }}","description":"","frontmatter":{},"headers":[],"relativePath":"zn/todo/index.md","filePath":"zn/todo/index.md","lastUpdated":1733132969000}'),p={name:"zn/todo/index.md"},d={id:"frontmatter-title",tabindex:"-1"};function r(a,s,F,g,E,y){return l(),h("div",null,[i("h1",d,[n(k(a.$frontmatter.title)+" ",1),s[0]||(s[0]=i("a",{class:"header-anchor",href:"#frontmatter-title","aria-label":'Permalink to "{{ $frontmatter.title }}"'},"​",-1))]),s[1]||(s[1]=e('<h2 id="排队优化" tabindex="-1">排队优化 <a class="header-anchor" href="#排队优化" aria-label="Permalink to &quot;排队优化&quot;">​</a></h2><ul><li>[✗] 学生转校区，校区迁移，代理商迁移, 组织架构的优化。目前迁移不是很明朗，不确定迁移后对系统的影响，需要搞清楚</li><li>[✗] 有些脚本可以做成后台功能，需要整理</li><li>[✗] 设备绑定发现excel里指定了校区，但是pad表中没字段的情况，需要排查</li><li>[✗] 线上数据库有些表的索引冗余，可以评估一下然后删除</li><li>[✓] 迁移PolarDB测试数据库操作的脚本写完并且自测了</li><li>[✗] 给董老师写一个1对1学生学习，词汇量测评 单词对错的脚本</li><li>[✗] 定期清理 <code>口语</code>，<code>发音口语</code>, <code>课文</code> 无用的音频文件。已经统计完毕，等待清理。需要一个有删除权限的ak</li><li>[✗] 代码中的注释看看哪些能删除，比如 xx鑫。</li><li>[✗] admin 有 校区延期接口，为什么没用？</li><li>[✗] 整理工作文档</li></ul><h2 id="写一个1对1学生学习-词汇量测评-单词对错的脚本" tabindex="-1">写一个1对1学生学习，词汇量测评 单词对错的脚本 <a class="header-anchor" href="#写一个1对1学生学习-词汇量测评-单词对错的脚本" aria-label="Permalink to &quot;写一个1对1学生学习，词汇量测评 单词对错的脚本&quot;">​</a></h2><p>student_id, student_name, grade, word_id, answer_type, created_at</p><p>一个学习的，一个词汇量测评的，1对2错</p><h2 id="cross-线上部分表的索引建的比较冗余-甚至有些可以删除" tabindex="-1">[✗] 线上部分表的索引建的比较冗余，甚至有些可以删除 <a class="header-anchor" href="#cross-线上部分表的索引建的比较冗余-甚至有些可以删除" aria-label="Permalink to &quot;[&amp;cross;] 线上部分表的索引建的比较冗余，甚至有些可以删除&quot;">​</a></h2><h3 id="student-sentence-statistics" tabindex="-1">student_sentence_statistics <a class="header-anchor" href="#student-sentence-statistics" aria-label="Permalink to &quot;student_sentence_statistics&quot;">​</a></h3><p>去掉 student_id 索引，因为有联合索引了。考虑加一个 KEY <code>stu_nrvat</code> (<code>student_id</code>,<code>next_review_at</code>) USING BTREE。参照 student_word_statistics 表。</p><h3 id="student-study-history" tabindex="-1">student_study_history <a class="header-anchor" href="#student-study-history" aria-label="Permalink to &quot;student_study_history&quot;">​</a></h3><p>去掉 索引，KEY <code>student_id</code> (<code>student_id</code>), 其他的联合索引里已经有student_id了</p><h2 id="待上线功能" tabindex="-1">待上线功能 <a class="header-anchor" href="#待上线功能" aria-label="Permalink to &quot;待上线功能&quot;">​</a></h2><ul><li>发音课程+课程可见性+校区充值明细+词汇量测评列表+UA整合等</li></ul><h2 id="资源代办" tabindex="-1">资源代办 <a class="header-anchor" href="#资源代办" aria-label="Permalink to &quot;资源代办&quot;">​</a></h2><p>之后的短语，句型，语法都先不做，只做单词。</p><ul><li>[] 2024人教版三年级上 同步课文 上线</li><li>[] 2024人教版七年级上 语法 上线</li><li>[] 有校区要求增加 2024人教版七年级上 短语</li></ul><h2 id="yugong-慢sql" tabindex="-1">yugong 慢sql <a class="header-anchor" href="#yugong-慢sql" aria-label="Permalink to &quot;yugong 慢sql&quot;">​</a></h2><h2 id="unit-examine-word-已有结论" tabindex="-1">unit_examine_word [已有结论] <a class="header-anchor" href="#unit-examine-word-已有结论" aria-label="Permalink to &quot;unit_examine_word [已有结论]&quot;">​</a></h2><p>[2024-11-21 01:47:30 568][ERROR][SQL Run Times = 184.798]:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">distinct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `word_id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `num`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`student_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `_tid`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `unit_examine_word`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> where</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `wrong_num`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2024-11-20 00:00:00&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2024-11-20 23:59:59&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">group by</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student_id</span></span></code></pre></div><ul><li>已有索引： KEY <code>unit_examine_id</code> (<code>unit_examine_id</code>) USING BTREE, KEY <code>idx_studentid_createdat_wrongnum_wordid</code> (<code>student_id</code>,<code>created_at</code>,<code>wrong_num</code>,<code>word_id</code>) 都用不上</li><li>增加 KEY <code>time_st</code> (<code>created_at</code>,<code>student_id</code>) USING BTREE 即可</li><li>修改代码工作量太大，需要重新整体设计，还是决定采用增加索引的方式解决</li><li>表目前有1亿3千万数据，加索引比较慢</li></ul><h2 id="student-word-statistics-已有结论" tabindex="-1">student_word_statistics [已有结论] <a class="header-anchor" href="#student-word-statistics-已有结论" aria-label="Permalink to &quot;student_word_statistics [已有结论]&quot;">​</a></h2><p>[2024-11-21 02:49:09 269][ERROR][SQL Run Times = 1785.5651]:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">distinct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `word_id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `learned_num`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`student_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `_tid`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `student_word_statistics`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> where</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `shorthand_num`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> group by</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student_id</span></span></code></pre></div><ul><li>需要改实现方式，shorthand_num 不太适合加索引</li></ul><p>[2024-11-22 01:40:27 424][ERROR][SQL Run Times = 1704.1786]:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select distinct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `student_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `student_word_statistics`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WHERE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `next_review_at`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;2024-11-21 21:00:00&#39;</span></span></code></pre></div><ul><li>增加 KEY <code>nrvat_stu</code> (<code>next_review_at</code>,<code>student_id</code>) USING BTREE 即可</li></ul><p>[2024-11-21 02:19:08 992][ERROR][SQL Run Times = 1790.1353]:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">distinct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `word_id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `familiar_num`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`student_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `_tid`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `student_word_statistics`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> where</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  `word_review_frequency`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">05</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `word_review_frequency`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `next_review_at`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;2024-11-21 01:49:18&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `word_review_frequency`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">05</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> group by</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student_id</span></span></code></pre></div><p>-- 给 next_review_at 加完索引之后，同样适用此处</p><p>[2024-11-21 02:19:23 694][ERROR][SQL Run Times = 13.7832]:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">distinct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `sentence_id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `familiar_num`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`student_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `_tid`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `student_sentence_statistics`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> where</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `sentence_review_frequency`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `next_review_at`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;2024-11-21 02:19:09&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> group by</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student_id</span></span></code></pre></div><p>-- 给 next_review_at 加完索引之后，同样适用此处</p><p>[2024-11-21 08:58:04 930][ERROR][SQL Run Times = 5464.2807]:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">distinct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `word_id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `num`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`student_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `_tid`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `student_word_statistics`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> where</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `next_review_at`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;2024-11-21 07:27:00&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`highest_wordset_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> IN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">503</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">429</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">431</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">432</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">433</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">434</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `wordset_word_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `article_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">group by</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student_id</span></span></code></pre></div><ul><li>分批次查询学生，每次指定部分学生id，可以解决这个问题</li></ul><h2 id="student-review-word-已有结论" tabindex="-1">student_review_word [已有结论] <a class="header-anchor" href="#student-review-word-已有结论" aria-label="Permalink to &quot;student_review_word [已有结论]&quot;">​</a></h2><p>[2024-11-21 07:16:48 557][ERROR][SQL Run Times = 9458.0262]:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`duration`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `duration`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `num`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`student_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `_tid`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `student_review_word`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> where</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `status`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2024-11-01 00:00:00&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2024-11-30 23:59:59&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">group by</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student_id</span></span></code></pre></div><p>[2024-11-21 04:39:09 147][ERROR][SQL Run Times = 5576.0403]:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`duration`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `duration`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `num`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`student_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `_tid`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `student_review_word`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> where</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `status`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2024-11-01 00:00:00&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2024-11-30 23:59:59&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">group by</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student_id</span></span></code></pre></div><h2 id="student-punch-待定" tabindex="-1">student_punch [待定] <a class="header-anchor" href="#student-punch-待定" aria-label="Permalink to &quot;student_punch [待定]&quot;">​</a></h2><p>[2024-11-22 01:41:24 657][ERROR][SQL Run Times = 23.3709]:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">update</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `student_punch`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `status`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> where</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `type`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `status`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">not</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select DISTINCT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `student_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `student_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `student_study_history`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> where</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `type`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `created_at`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;2024-11-21 00:00:00&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `created_at`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;2024-11-21 23:59:59&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h2 id="unit-text-article-sentence-已有结论" tabindex="-1">unit_text_article_sentence [已有结论] <a class="header-anchor" href="#unit-text-article-sentence-已有结论" aria-label="Permalink to &quot;unit_text_article_sentence [已有结论]&quot;">​</a></h2><p>[2024-11-21 01:48:59 610][ERROR][SQL Run Times = 48.6618]:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`duration`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `duration`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">distinct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `text_article_id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `num`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`student_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `_tid`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `unit_text_article_sentence`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WHERE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `type`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2024-11-20 00:00:00&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2024-11-20 23:59:59&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">group by</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student_id</span></span></code></pre></div><ul><li>已有 KEY <code>idx_student_time</code> (<code>student_id</code>,<code>created_at</code>)</li><li>增加 KEY <code>time_st</code> (<code>created_at</code>,<code>student_id</code>) USING BTREE 即可</li></ul><h1 id="newenglish-慢sql" tabindex="-1">newenglish 慢sql <a class="header-anchor" href="#newenglish-慢sql" aria-label="Permalink to &quot;newenglish 慢sql&quot;">​</a></h1><p>[2024-07-23 09:10:54 968][ERROR][c4skbhmds17id03j225top1g42][218.68.158.241][SQL Run Times = 3.7398]: SELECT <code>store_id</code>,SUM(cancel_fee) as cancel_fee,SUM(fee) as fee FROM card_word WHERE <code>store_id</code> IN (:store_id_1_i0,:store_id_1_i1,:store_id_1_i2,:store_id_1_i3,:store_id_1_i4,:store_id_1_i5,:store_id_1_i6,:store_id_1_i7) GROUP BY store_id</p><h4 id="yugong-重构" tabindex="-1">yugong 重构 <a class="header-anchor" href="#yugong-重构" aria-label="Permalink to &quot;yugong 重构&quot;">​</a></h4><ul><li>采用golang重写，并发性能好一点</li><li>增加消息消费本地表</li><li>支持消息重试机制</li><li>统计表重新设计，考虑是否可用Es, starRocks等产品</li></ul>',52))])}const u=t(p,[["render",r]]);export{c as __pageData,u as default};
